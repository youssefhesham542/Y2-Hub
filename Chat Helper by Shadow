-- Services
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local chatService = game:GetService("TextChatService")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CustomChat"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 400, 0, 300)
Frame.Position = UDim2.new(0.5, -200, 0.5, -150) -- ğŸ”¥ ÙÙŠ Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ø¸Ø¨Ø·
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.BackgroundTransparency = 0.2
Frame.Active = true
Frame.Draggable = true 
Frame.Parent = ScreenGui

-- ğŸ”´ Ø®Ø· Ø£Ø­Ù…Ø± Ø­ÙˆØ§Ù„ÙŠÙ† Ø§Ù„ÙØ±ÙŠÙ…
local stroke = Instance.new("UIStroke")
stroke.Thickness = 3
stroke.Color = Color3.fromRGB(255, 0, 0)
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Parent = Frame

-- Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ (X)
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5) -- ÙÙˆÙ‚ ÙŠÙ…ÙŠÙ†
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
CloseButton.Parent = Frame

CloseButton.MouseButton1Click:Connect(function()
    Frame.Visible = false -- ÙŠØ®ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
end)

-- Scroll for messages
local ScrollingFrame = Instance.new("ScrollingFrame")
ScrollingFrame.Size = UDim2.new(1, -20, 1, -60)
ScrollingFrame.Position = UDim2.new(0, 10, 0, 40)
ScrollingFrame.CanvasSize = UDim2.new(0,0,0,0)
ScrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
ScrollingFrame.BackgroundTransparency = 1
ScrollingFrame.Parent = Frame

local UIListLayout = Instance.new("UIListLayout", ScrollingFrame)
UIListLayout.Padding = UDim.new(0, 5)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- TextBox
local TextBox = Instance.new("TextBox")
TextBox.Size = UDim2.new(0.75, -15, 0, 40)
TextBox.Position = UDim2.new(0, 10, 1, -45)
TextBox.PlaceholderText = "Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø±Ø³Ø§Ù„ØªÙƒ..."
TextBox.Text = ""
TextBox.TextColor3 = Color3.fromRGB(255,255,255)
TextBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
TextBox.ClearTextOnFocus = true 
TextBox.Parent = Frame

-- Button
local Button = Instance.new("TextButton")
Button.Size = UDim2.new(0.25, -15, 0, 40)
Button.Position = UDim2.new(0.75, 5, 1, -45)
Button.Text = "Ø§Ø±Ø³Ø§Ù„"
Button.TextColor3 = Color3.fromRGB(255,255,255)
Button.BackgroundColor3 = Color3.fromRGB(70,70,70)
Button.Parent = Frame

-- Function to add messages
local function AddMessage(senderName, message)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -10, 0, 25)
    label.Text = senderName..": "..message
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255,255,255)
    label.Font = Enum.Font.SourceSans
    label.TextSize = 18
    label.Parent = ScrollingFrame
end

-- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
Button.MouseButton1Click:Connect(function()
    local msg = TextBox.Text
    if msg ~= "" then
        if chatService.ChatVersion == Enum.ChatVersion.TextChatService then
            local channel = chatService.TextChannels:FindFirstChild("RBXGeneral")
            if channel then
                channel:SendAsync(msg)
            end
        end
        TextBox.Text = ""
    end
end)

-- Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
if chatService.ChatVersion == Enum.ChatVersion.TextChatService then
    local channel = chatService.TextChannels:FindFirstChild("RBXGeneral")
    if channel then
        channel.MessageReceived:Connect(function(msg)
            local senderName = msg.TextSource and msg.TextSource.Name or "??"
            local message = msg.Text
            AddMessage(senderName, message)
        end)
    end
else
    warn("TextChatService ØºÙŠØ± Ù…ÙØ¹Ù„ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³ÙŠØ±ÙØ±")
end
