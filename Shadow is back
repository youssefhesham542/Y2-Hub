import tkinter as tk
from tkinter import ttk, messagebox, scrolledtext
import requests
from collections import Counter
import matplotlib.pyplot as plt
from wordcloud import WordCloud

def fetch_wikipedia_summary(keyword):
    url = f"https://ar.wikipedia.org/api/rest_v1/page/summary/{keyword}"
    resp = requests.get(url)
    if resp.status_code == 200:
        data = resp.json()
        return data.get('extract', 'لم يتم العثور على ملخص.')
    else:
        return "حدث خطأ أثناء جلب البيانات."

def analyze_text(text):
    words = [word for word in text.split() if len(word) > 3]
    counter = Counter(words)
    return counter

def save_to_file(keyword, summary, counter):
    with open(f"{keyword}_result.txt", "w", encoding="utf-8") as f:
        f.write(f"كلمة البحث: {keyword}\n")
        f.write("ملخص ويكيبيديا:\n")
        f.write(summary + "\n\n")
        f.write("إحصائيات الكلمات:\n")
        for word, count in counter.most_common(20):
            f.write(f"{word}: {count}\n")

def plot_wordcloud(counter):
    wordcloud = WordCloud(width=800, height=400, background_color="white", font_path="arial.ttf").generate_from_frequencies(counter)
    plt.figure(figsize=(10,5))
    plt.imshow(wordcloud, interpolation="bilinear")
    plt.axis("off")
    plt.show()

def plot_bar_graph(counter):
    common = counter.most_common(10)
    if not common:
        messagebox.showwarning("لا يوجد بيانات", "لا يوجد بيانات لرسم الرسم البياني.")
        return
    words, counts = zip(*common)
    plt.figure(figsize=(8,4))
    plt.bar(words, counts, color='skyblue')
    plt.title("أكثر الكلمات تكراراً")
    plt.xlabel("الكلمة")
    plt.ylabel("عدد التكرار")
    plt.tight_layout()
    plt.show()

def process():
    keyword = keyword_var.get().strip()
    if not keyword:
        messagebox.showerror("خطأ", "يرجى إدخال كلمة البحث.")
        return
    summary = fetch_wikipedia_summary(keyword)
    result_text.delete(1.0, tk.END)
    result_text.insert(tk.END, summary)
    counter = analyze_text(summary)
    save_to_file(keyword, summary, counter)
    plot_bar_graph(counter)
    plot_wordcloud(counter)

root = tk.Tk()
root.title("أداة تحليل ويكيبيديا المتقدمة")

mainframe = ttk.Frame(root, padding="10")
mainframe.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))

ttk.Label(mainframe, text="أدخل كلمة البحث (بالعربي):").grid(row=0, column=0, sticky=tk.W)
keyword_var = tk.StringVar()
keyword_entry = ttk.Entry(mainframe, width=40, textvariable=keyword_var)
keyword_entry.grid(row=0, column=1, padx=5)

search_btn = ttk.Button(mainframe, text="ابحث وحلّل", command=process)
search_btn.grid(row=0, column=2, padx=5)

result_text = scrolledtext.ScrolledText(mainframe, width=60, height=15, wrap=tk.WORD)
result_text.grid(row=1, column=0, columnspan=3, pady=10)

ttk.Label(mainframe, text="النتائج ستظهر هنا.").grid(row=2, column=0, columnspan=3)

root.mainloop()
             
